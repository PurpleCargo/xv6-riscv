# Informe Tarea 4 - Sistemas Operativos, Sec. 1
### Nombre: Eduardo Torres Lagos
### Sistema: Windows 11, WSL2, Ubuntu 22.04.3 LTS

## Ignorar archivo INFORME.md, corresponde a tarea 1

## Funcionamiento y lógica

El campo de permisos de la estructura del inodo se usa para gestionar el control de acceso y la inmutabilidad de archivos. Este permite:

Permisos R/W:

    0: No permisos de escritura o lectura
    1: Solo lectura
    2: Solo escritura
    3: Escritura y lectura (predeterminado para archivos nuevos)

Comportamiento de archivos inmutables:

    5: Marcar el archivo como inmutable, evitando cualquier cambio adicional en sus contenidos o metadata

chmod

Esta llamada de sistema provee una interface para que los programas de usuario modifiquen los permisos de un archivo. Realiza las siguientes tareas:

Validación de argumentos:

    Garantiza que el path del archivo y el modo de permiso sean válidos
    Restringe modos inválidos (mode < 0, mode > 3, y modos distintos de 5)

Cambios de lógica de permiso:

    Evita la modificación de archivos inmutables (permissions == 5)
    Actualiza el campo de permisos del inodo respectivo

Sincronización

    Garantiza que los cambios en el campo de permisos del inodo se escriban en el disco mediante iupdate()

## Modificaciones realizadas

file.h

Adición del campo permissions dentro del struct inode, donde 0 es no acceso, 1 es solo lectura, 2 es solo escritura, 3 es escritura y lectura
y 5 es inmutable

fs.c

    iget()

Inicialización del campo permissions en 3 cuando un inodo se carga en la memoria

sysfile.c

    sys_chmod(void)

Adición de nueva llamada de sistema para actualizar los permisos de un archivo en base al campo permissions del inodo respectivo, la lógica
incluye controles de inmutabilidad y validez

syscall.h

Asignación de número de llamada de sistema a chmod

syscall.c

Añadición de entrada de chmod en la tabla de syscalls

user.h

Añadición de declaración orientada al usuario para chmod

usys.pl

Añadición de código auxiliar (stub) de llamada de sistema para chmod

chmod_test.c

Programa de prueba para validar la implementación de chmod intentando cambiar los permisos y garantizando que se aplique la inmutabilidad

Makefile

Adición de reglas de compilación para chmod_test y dentro de la lista de UPROGS


## Dificultades encontradas

Considero que la mayor dificultad que encontré fue no darme cuenta de que la estructura del inodo se encontraba en file.h, por lo que intenté realizar la
implementación con la estructura del dinode en fs.h, lo cual me trajo un par de problemas, como un problema relacionado a Bsize del dinodo, el cual no supe
solucionar, pero al encontrar el struct del inodo pude seguir con la implementación sin muchos problemas.

Otra dificultad encontrada fue en relación al programa de prueba, dado que requería de constantes como O_CREATE, que se encontraban en el archivo
fcntl.h, por lo que lo solucioné incluyendo ese header en el programa de prueba.

Otras dificultades menores se asociaron con la implementación de la llamada de sistema y el programa de prueba, como ponerle chmodtest de nombre al archivo
y que no se compilara xv6 dado que las reglas de compilación tenían al programa de prueba como chmod_test, entre otros problemas